<div class="recycle-bin-container">
  <!-- Toolbar with custom recycle bin actions -->
  <app-toolbar [viewMode]="viewMode" [hasSelection]="hasSelectedItems" [selectionCount]="selectedItems.length"
    [pageIndex]="pageIndex" [pageSize]="pageSize" [totalItems]="totalItems" [showUploadButton]="false"
    [showCreateFolderButton]="false" [showStandardSelectionActions]="false" (viewModeChange)="onViewModeChange($event)"
    (clearSelection)="onClearSelection()" (previousPage)="onPreviousPage()" (nextPage)="onNextPage()"
    (pageSizeChange)="onPageSizeChange($event)">

    <!-- Breadcrumb projected into toolbar for mobile visibility -->
    <div toolbarBreadcrumb class="toolbar-breadcrumb-compact">
      @if(breadcrumbTrail.length > 0) {
      <button mat-icon-button (click)="navigateBack()" [attr.aria-label]="'recycleBin.navigateBack' | translate"
        class="breadcrumb-back-btn">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <mat-icon class="separator">chevron_right</mat-icon>
      <span class="breadcrumb-text">{{ breadcrumbTrail[breadcrumbTrail.length - 1].name }}</span>
      } @else {
      <button mat-icon-button (click)="navigateToHome()" [attr.aria-label]="'recycleBin.title' | translate"
        class="breadcrumb-home-btn">
        <mat-icon>delete</mat-icon>
      </button>
      <span class="breadcrumb-text">{{ 'recycleBin.title' | translate }}</span>
      }
    </div>

    <!-- Custom recycle bin actions projected into toolbar -->
    <div toolbarActions class="recycle-bin-actions">
      <button mat-raised-button color="primary" (click)="restoreSelected()" [disabled]="selectedItemsCount === 0"
        [matTooltip]="'recycleBin.restoreTooltip' | translate" class="restore-btn">
        <mat-icon>restore</mat-icon>
        <span>{{ 'recycleBin.restore' | translate }}</span>
      </button>
      <button mat-raised-button color="warn" (click)="permanentlyDeleteSelected()" [disabled]="selectedItemsCount === 0"
        [matTooltip]="'recycleBin.deleteForeverTooltip' | translate" class="delete-forever-btn">
        <mat-icon>delete_forever</mat-icon>
        <span>{{ 'recycleBin.deleteForever' | translate }}</span>
      </button>
      <button mat-raised-button (click)="emptyRecycleBin()" [disabled]="items.length === 0"
        [matTooltip]="'recycleBin.emptyBinTooltip' | translate" class="empty-bin-btn">
        <mat-icon>delete_sweep</mat-icon>
        <span>{{ 'recycleBin.emptyBin' | translate }}</span>
      </button>
    </div>
  </app-toolbar>

  <div class="recycle-bin-content">
    @if (loading) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>{{ 'recycleBin.loading' | translate }}</p>
    </div>
    }

    @if (!loading && items.length === 0) {
    <div class="empty-state">
      <mat-icon class="empty-icon">delete_outline</mat-icon>
      <h2>{{ 'recycleBin.emptyTitle' | translate }}</h2>
      <p>{{ 'recycleBin.emptyMessage' | translate }}</p>
      <p class="info-text">{{ 'recycleBin.autoDeleteInfo' | translate }}</p>
    </div>
    }

    @if (!loading && items.length > 0) {
    @if (viewMode === 'grid') {
    <app-file-grid [items]="items" [showFavoriteButton]="false" (itemClick)="onItemClick($event)"
      (itemDoubleClick)="onItemDoubleClick($event)" (selectionChange)="onSelectionChange($event)"
      (toggleFavorite)="onToggleFavorite($event)" (rename)="onRenameItem($event)" (download)="onDownloadItem($event)"
      (move)="onMoveItem($event)" (copy)="onCopyItem($event)" (delete)="onDeleteItem($event)">
    </app-file-grid>
    }

    @if (viewMode === 'list') {
    <app-file-list [items]="items" [showFavoriteButton]="false" (itemClick)="onItemClick($event)"
      (itemDoubleClick)="onItemDoubleClick($event)" (selectionChange)="onSelectionChange($event)"
      (selectAll)="onSelectAll($event)" (toggleFavorite)="onToggleFavorite($event)" (rename)="onRenameItem($event)"
      (download)="onDownloadItem($event)" (move)="onMoveItem($event)" (copy)="onCopyItem($event)"
      (delete)="onDeleteItem($event)">
    </app-file-list>
    }
    }
  </div>
</div>

<!-- Mobile FAB (Floating Action Button) -->
@if (items.length > 0) {
<div class="recycle-bin-fab-container" [class.fab-open]="fabOpen">
  <!-- Main FAB -->
  <button mat-fab color="primary" class="main-fab" (click)="toggleFab()"
    [attr.aria-label]="(fabOpen ? 'recycleBin.closeActions' : 'recycleBin.openActions') | translate"
    [attr.aria-expanded]="fabOpen">
    <mat-icon [class.fab-icon-rotated]="fabOpen" aria-hidden="true">
      {{ fabOpen ? 'close' : 'menu' }}
    </mat-icon>
  </button>

  <!-- Speed Dial Actions -->
  @if (fabOpen) {
  <div class="fab-speed-dial" role="menu" [attr.aria-label]="'recycleBin.recycleBinActions' | translate">
    @if (selectedItemsCount > 0) {
    <div class="speed-dial-item">
      <button mat-mini-fab class="speed-dial-btn restore-dial-btn" (click)="onRestoreFromFab()"
        [attr.aria-label]="'recycleBin.restoreTooltip' | translate" role="menuitem">
        <mat-icon aria-hidden="true">restore</mat-icon>
      </button>
      <span class="speed-dial-label restore-label">{{ 'recycleBin.restore' | translate }}</span>
    </div>

    <div class="speed-dial-item">
      <button mat-mini-fab class="speed-dial-btn delete-forever-dial-btn" (click)="onDeleteForeverFromFab()"
        [attr.aria-label]="'recycleBin.deleteForeverTooltip' | translate" role="menuitem">
        <mat-icon aria-hidden="true">delete_forever</mat-icon>
      </button>
      <span class="speed-dial-label delete-forever-label">{{ 'recycleBin.deleteForever' | translate }}</span>
    </div>
    }

    <div class="speed-dial-item">
      <button mat-mini-fab class="speed-dial-btn empty-bin-dial-btn" (click)="onEmptyBinFromFab()"
        [attr.aria-label]="'recycleBin.emptyBinTooltip' | translate" role="menuitem">
        <mat-icon aria-hidden="true">delete_sweep</mat-icon>
      </button>
      <span class="speed-dial-label empty-bin-label">{{ 'recycleBin.emptyBin' | translate }}</span>
    </div>
  </div>
  }

  <!-- Backdrop overlay -->
  @if (fabOpen) {
  <div class="fab-backdrop" (click)="closeFab()" aria-hidden="true"></div>
  }
</div>
}