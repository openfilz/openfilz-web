<div class="search-results-container">
  <app-toolbar
    [viewMode]="viewMode"
    [totalItems]="totalItems"
    [isSearchResultsPage]="true"
    [hasSelection]="hasSelectedItems"
    [selectionCount]="selectedItems.length"
    [sortBy]="sortBy"
    [sortOrder]="sortOrder"
    (viewModeChange)="onViewModeChange($event)"
    (sortChange)="onSortChange($event)"
    (renameSelected)="onRenameSelected()"
    (downloadSelected)="onDownloadSelected()"
    (moveSelected)="onMoveSelected()"
    (copySelected)="onCopySelected()"
    (deleteSelected)="onDeleteSelected()"
    (clearSelection)="onSelectAll(false)">
  </app-toolbar>

  <main class="search-results-content" role="main" aria-label="Search results">
    <div class="search-header">
      <h1 class="search-title">Search results for "{{ searchQuery }}"</h1>
      @if(!loading && items.length > 0) {
        <p class="search-count" role="status" aria-live="polite" aria-atomic="true">
          Found {{ totalItems }} {{ totalItems === 1 ? 'result' : 'results' }}
        </p>
      }
    </div>
    @if(!loading) {
      @if(items.length === 0) {
        <div class="empty-state" role="status" aria-live="polite">
          <mat-icon aria-hidden="true">search_off</mat-icon>
          <h2>No results found</h2>
          <p>Try adjusting your search terms or filters</p>
        </div>
      }
      @if(viewMode === 'grid' && items.length > 0) {
        <app-file-grid
          [items]="items"
          (itemClick)="onItemClick($event)"
          (itemDoubleClick)="onItemDoubleClick($event)"
          (selectionChange)="onSelectionChange($event)"
          (rename)="onRenameItem($event)"
          (download)="onDownloadItem($event)"
          (move)="onMoveItem($event)"
          (copy)="onCopyItem($event)"
          (delete)="onDeleteItem($event)"
          (toggleFavorite)="onToggleFavorite($event)"
          (viewProperties)="onViewProperties($event)">
        </app-file-grid>
      }
      @if(viewMode === 'list' && items.length > 0) {
        <app-file-list
          [items]="items"
          [sortBy]="sortBy"
          [sortOrder]="sortOrder"
          (itemClick)="onItemClick($event)"
          (itemDoubleClick)="onItemDoubleClick($event)"
          (selectionChange)="onSelectionChange($event)"
          (selectAll)="onSelectAll($event)"
          (sortChange)="onSortChange($event)"
          (rename)="onRenameItem($event)"
          (download)="onDownloadItem($event)"
          (move)="onMoveItem($event)"
          (copy)="onCopyItem($event)"
          (delete)="onDeleteItem($event)"
          (toggleFavorite)="onToggleFavorite($event)"
          (viewProperties)="onViewProperties($event)">
        </app-file-list>
      }
    } @else {
      <div class="loading-container" role="status" aria-live="polite" aria-busy="true">
        <mat-spinner aria-hidden="true"></mat-spinner>
        <p>Searching for "{{ searchQuery }}"...</p>
        <span class="sr-only">Loading search results</span>
      </div>
    }
  </main>

  <!-- Metadata Panel -->
  <app-metadata-panel
    [documentId]="selectedDocumentForMetadata"
    [isOpen]="metadataPanelOpen"
    (closePanel)="closeMetadataPanel()"
    (metadataSaved)="onMetadataSaved()">
  </app-metadata-panel>
</div>
