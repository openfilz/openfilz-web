<div class="header">
    <button class="mobile-menu-button" (click)="onMobileMenuToggle()"
        [attr.aria-label]="'header.toggleMobileMenu' | translate">
        <mat-icon aria-hidden="true">menu</mat-icon>
    </button>

    <div class="header-left">
        <div class="search-box">
            <svg class="search-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input type="text" [placeholder]="'header.searchPlaceholder' | translate" [(ngModel)]="searchQuery"
                (input)="onSearchInput()" (keyup.enter)="onSearch()" [class.has-active-filters]="hasActiveFilters()">

            @if (searchQuery) {
            <button class="clear-search-button" (click)="clearSearch()"
                [attr.aria-label]="'header.clearSearch' | translate">
                <mat-icon aria-hidden="true">close</mat-icon>
            </button>
            }

            <!-- Filter button for desktop (inside search box) -->
            <button class="filter-button desktop-filter" [class.active]="showFilters || hasActiveFilters()" (click)="toggleFilters()"
                [matTooltip]="'header.searchFilters' | translate"
                [attr.aria-label]="'header.searchFilters' | translate">
                <mat-icon aria-hidden="true">tune</mat-icon>
                @if (hasActiveFilters()) {
                <span class="filter-badge" [attr.aria-label]="'header.activeFilters' | translate"></span>
                }
            </button>

            <!-- Suggestions Dropdown -->
            @if (suggestions.length > 0) {
            <ul class="suggestions-list">
                @for (suggestion of suggestions; track $index) {
                <li class="suggestion-info" (click)="selectSuggestion(suggestion)">
                    <i class="suggestion-icon" [ngClass]="getIconForExtension(suggestion.ext)"></i>
                    <span class="suggestion-text">{{ suggestion.s }}</span>
                    <div class="suggestion-actions">
                        <i class="fa-solid fa-eye" [title]="'common.view' | translate"
                            (click)="onOpen(suggestion, $event)"></i>
                        <i class="fa-solid fa-download" [title]="'common.download' | translate"
                            (click)="onDownload(suggestion, $event)"></i>
                    </div>
                </li>
                }
            </ul>
            }
            @if (showFilters) {
            <app-search-filters [initialFilters]="currentFilters" (filtersChanged)="onFiltersChanged($event)"
                (close)="toggleFilters()">
            </app-search-filters>
            }
        </div>
    </div>
    <div class="header-right">
        <!-- Filter button for mobile (in header-right) -->
        <button class="filter-button mobile-filter" [class.active]="showFilters || hasActiveFilters()" (click)="toggleFilters()"
            [attr.aria-label]="'header.searchFilters' | translate">
            <mat-icon aria-hidden="true">tune</mat-icon>
            @if (hasActiveFilters()) {
            <span class="filter-badge" [attr.aria-label]="'header.activeFilters' | translate"></span>
            }
        </button>
        <!-- Avatar with Menu -->
        <div class="avatar" [matMenuTriggerFor]="avatarMenu">{{ userInitials }}</div>
        <mat-menu #avatarMenu="matMenu" class="avatar-menu">
           <!-- Language submenu -->
            <button mat-menu-item [matMenuTriggerFor]="languageMenu">
                <mat-icon>language</mat-icon>
                <span>{{ 'header.language' | translate }}</span>
            </button>
            <!-- Settings -->
            <button mat-menu-item (click)="navigateToSettings()">
                <mat-icon>settings</mat-icon>
                <span>{{ 'header.settings' | translate }}</span>
            </button>
            <!-- Logout -->
            <button mat-menu-item (click)="onLogout()">
                <mat-icon class="rtl-flip">logout</mat-icon>
                <span>{{ 'header.logout' | translate }}</span>
            </button>
        </mat-menu>

        <!-- Language submenu -->
        <mat-menu #languageMenu="matMenu" class="language-menu">
            @for (lang of availableLanguages; track lang.code) {
            <button mat-menu-item (click)="switchLanguage(lang)" [class.active]="lang.code === currentLanguage.code">
                <span class="lang-name">{{ lang.name }}</span>
                @if (lang.code === currentLanguage.code) {
                <mat-icon class="check-icon">check</mat-icon>
                }
            </button>
            }
        </mat-menu>
    </div>
</div>