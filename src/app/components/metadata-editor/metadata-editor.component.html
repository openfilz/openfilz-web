<div class="metadata-editor">
  @if(showTitle) {
  <div class="metadata-header">
    <h3>{{ 'common.metadata' | translate }}</h3>
    @if(!readonly && metadataEntries.length > 0) {
    <button mat-button color="warn" (click)="clearAll()" [matTooltip]="'metadataEditor.clearAllTooltip' | translate"
      class="clear-button">
      <mat-icon>clear_all</mat-icon>
      {{ 'metadataEditor.clearAll' | translate }}
    </button>
    }
  </div>
  }

  <div class="metadata-entries">
    @if(metadataEntries.length === 0 && readonly) {
    <div class="no-metadata">
      <mat-icon>info</mat-icon>
      <p>{{ 'metadataEditor.noMetadata' | translate }}</p>
    </div>
    }

    @for(entry of metadataEntries; track $index) {
    <div class="metadata-entry" [class.has-error]="entry.error">
      <mat-form-field appearance="outline" class="key-field">
        <mat-label>{{ 'common.key' | translate }}</mat-label>
        <input matInput [(ngModel)]="entry.key" (ngModelChange)="onMetadataChange()" [readonly]="readonly"
          [placeholder]="'metadataEditor.keyPlaceholder' | translate"
          [attr.aria-label]="'metadataEditor.keyAriaLabel' | translate">
      </mat-form-field>

      <mat-form-field appearance="outline" class="value-field">
        <mat-label>{{ 'common.value' | translate }}</mat-label>
        <input matInput [(ngModel)]="entry.value" (ngModelChange)="onMetadataChange()" [readonly]="readonly"
          [placeholder]="'metadataEditor.valuePlaceholder' | translate"
          [attr.aria-label]="'metadataEditor.valueAriaLabel' | translate">
      </mat-form-field>

      @if(!readonly) {
      <button mat-icon-button color="warn" (click)="removeMetadataEntry($index)"
        [matTooltip]="'metadataEditor.removeEntryTooltip' | translate"
        [attr.aria-label]="'metadataEditor.removeEntryAriaLabel' | translate" class="remove-button">
        <mat-icon>delete</mat-icon>
      </button>
      }

      @if(entry.error) {
      <div class="error-message">
        <mat-icon class="error-icon">error</mat-icon>
        {{ entry.error }}
      </div>
      }
    </div>
    }
  </div>

  @if(!readonly) {
  <div class="add-entry-container">
    <button mat-stroked-button color="primary" (click)="addMetadataEntry()"
      [attr.aria-label]="'metadataEditor.addEntryAriaLabel' | translate">
      <mat-icon>add</mat-icon>
      {{ 'metadataEditor.addEntry' | translate }}
    </button>
  </div>
  }
</div>